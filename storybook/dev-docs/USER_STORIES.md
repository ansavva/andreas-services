# Storybook — User Stories (Implementation-Ready)

This document defines user stories for the Storybook product, structured by epic, and written to be suitable for direct handoff to AI code generation or engineering implementation.

---

## Technology Assumptions (Explicit)

These assumptions are **part of the requirements** and should be enforced in code.

### Chat / Story Generation
- **Provider:** OpenAI
- **API:** OpenAI Responses API
- **Mode:** Text-only (no image tools enabled)
- **Purpose:**  
  - Collaborative story ideation  
  - Character development  
  - Outline creation  
  - Page text generation  
  - Illustration *descriptions only* (no images)

### Image & Character Generation
- **Provider:** Stability.ai
- **Model Family:** Stable Diffusion XL (SDXL), hosted
- **Usage:**  
  - Child character generation from uploaded photos  
  - Preview “fun scenes”  
  - Final story page illustrations  
  - Page-level regeneration and variants
- **Key Requirement:** Character consistency via reference images + character bible

---

## Epic A: Marketing Home and Authentication

### US-A1: Marketing Splash Screen Layout
**As a** visitor  
**I want** to see a marketing splash screen that explains the product and prompts me to start  
**So that** I understand the value and can create my first story.

**Acceptance Criteria**
- Header contains:
  - Storybook logo at top-left (click navigates to home)
  - Account avatar placeholder at top-right
  - If not logged in: show **Login** button
  - If logged in: show avatar + account menu (Profile, My Stories, Logout)
- Home screen contains:
  - Product title (“Storybook”)
  - Supporting text describing personalized, AI-powered children’s stories
  - Primary CTA button: **Create your first story**
- CTA behavior:
  - If not logged in: redirect to login and then resume flow
  - If logged in: route to Kid Setup flow

---

### US-A2: Login / Logout
**As a** visitor  
**I want** to log in and out  
**So that** my stories and uploads are saved to my account.

**Acceptance Criteria**
- Supports email/password or SSO (initial stub acceptable)
- On login success, redirect to intended route
- Logout clears session and returns to Home
- UI reflects login state immediately

---

## Epic B: Create Story Project Flow

### US-B1: Create New Story Project
**As a** logged-in user  
**I want** to start a new story project  
**So that** I can create a personalized book.

**Acceptance Criteria**
- CTA creates a new `StoryProject` record
- Initial status: `DRAFT_SETUP`
- User routed to Kid Setup Step 1

---

## Epic C: Kid Setup (Name, Age, Consent, Photos)

### US-C1: Collect Child Name and Age
**As a** parent/guardian  
**I want** to provide my child’s name and age  
**So that** the story and illustrations are age-appropriate and personalized.

**Acceptance Criteria**
- Required fields: child name, child age
- Age validation (configurable range, e.g., 0–12)
- Continue disabled until valid
- Privacy/consent notice visible
- Data stored in `ChildProfile` linked to project

---

### US-C2: Upload Child Photos
**As a** parent/guardian  
**I want** to upload photos of my child  
**So that** Stability.ai can generate a consistent character.

**Acceptance Criteria**
- Upload 1–10 images (configurable)
- Accepted formats: jpg, png, webp
- Max file size enforced (e.g., 10MB)
- Thumbnail preview with remove option
- Guidance text for good photo quality
- Secure storage of uploads
- Retry on failure with clear error messaging

---

### US-C3: Consent Confirmation
**As a** parent/guardian  
**I want** to confirm I have the right to upload and process my child’s photos  
**So that** the product complies with safety and privacy requirements.

**Acceptance Criteria**
- Required checkbox:
  - “I am the parent/guardian or have permission to upload and process these images.”
- Continue disabled until confirmed
- Consent stored with timestamp and project ID

---

## Epic D: Character Generation and Preview (Stability.ai)

### US-D1: Generate Character Portrait
**As a** user  
**I want** Stability.ai to generate a stylized character portrait of my child (smiling)  
**So that** I can approve their appearance before storytelling.

**Acceptance Criteria**
- Use Stability.ai SDXL (hosted) for generation
- Generate primary smiling portrait
- Show loading and progress state
- User can approve or regenerate
- Approved portrait saved as `CharacterAsset`

---

### US-D2: Generate Fun Preview Scenes
**As a** user  
**I want** to see my child’s character in fun scenes generated by Stability.ai  
**So that** I can confirm character consistency.

**Acceptance Criteria**
- Generate 3–5 predefined scenes (e.g., park, space, pirate)
- Scenes generated using Stability.ai SDXL
- All scenes reference the same character identity
- Display in carousel or grid
- Allow per-scene regeneration
- User approves before continuing

---

### US-D3: Create Character Bible (System)
**As a** system  
**I want** to create a structured character definition  
**So that** Stability.ai can consistently reproduce the character.

**Acceptance Criteria**
- Store `character_bible` JSON including:
  - Physical traits
  - Style preset
  - Stability.ai reference image IDs
- Version bible if regenerated

---

## Epic E: Story Chat (OpenAI — Text Only)

### US-E1: Enter Story Chat
**As a** user  
**I want** to collaborate with AI in a text-only chat  
**So that** I can build my story interactively.

**Acceptance Criteria**
- Chat powered by OpenAI Responses API
- Text-only: no image generation tools enabled
- Chat UI with transcript and input
- Sidebar showing story progress
- Compile button disabled until minimum story data exists

---

### US-E2: Structured Story State
**As a** user  
**I want** story details to persist and evolve  
**So that** I can iterate without losing progress.

**Acceptance Criteria**
- OpenAI responses must return structured `StoryState` JSON:
  - title
  - age range (derived from child age)
  - characters
  - setting
  - outline
  - page count
- Version each update
- Display latest state in UI

---

### US-E3: Compile Story into Pages and Image Descriptions
**As a** user  
**I want** OpenAI to generate finalized pages and illustration descriptions  
**So that** Stability.ai can later generate images.

**Acceptance Criteria**
- Generate:
  - page text per page
  - page-level illustration descriptions (no images)
- Route user to Pages Editor

---

## Epic F: Pages Editor and Image Generation (Stability.ai)

### US-F1: Generate Images for Pages
**As a** user  
**I want** Stability.ai to generate images for each page  
**So that** the story becomes a visual book.

**Acceptance Criteria**
- Images generated using Stability.ai SDXL
- Use page specs + character bible
- Show per-page generation status
- Display text + image per page
- Retry on failure

---

### US-F2: Edit Page Text
**As a** user  
**I want** to edit page text independently  
**So that** I can refine the story.

**Acceptance Criteria**
- Inline text editor
- Save creates new page version
- Image regeneration optional

---

### US-F3: Modify Image Prompt and Regenerate
**As a** user  
**I want** to tweak image descriptions and regenerate pages  
**So that** I can improve visuals.

**Acceptance Criteria**
- Editable:
  - scene description
  - must-include list
  - must-avoid list
- Regenerate creates new image via Stability.ai
- Version history retained
- Allow revert to previous image

---

### US-F4: Generate Image Variants
**As a** user  
**I want** multiple image variants per page  
**So that** I can choose the best illustration.

**Acceptance Criteria**
- Generate N variants via Stability.ai
- Display variants in grid
- Select one as active

---

### US-F5: Enforce Character Consistency
**As a** user  
**I want** character consistency across pages  
**So that** the book feels cohesive.

**Acceptance Criteria**
- Always apply character bible + reference images
- Flag low-consistency outputs and suggest regeneration

---

## Epic G: Export

### US-G1: Export Storybook as PDF
**As a** user  
**I want** to export my book as a PDF  
**So that** I can download or share it.

**Acceptance Criteria**
- PDF includes:
  - cover page
  - all story pages (image + text)
- Configurable page size
- Server-side PDF generation
- Downloadable file

---

### US-G2: PDF Branding
**As a** product owner  
**I want** Storybook branding in the PDF  
**So that** exports are consistent.

**Acceptance Criteria**
- Logo or footer included
- No intrusive watermark

---

## Epic H: Project Management

### US-H1: My Stories
**As a** user  
**I want** to see my story projects  
**So that** I can resume or export them.

**Acceptance Criteria**
- List projects with status and last updated
- Actions: open, rename, delete (optional), export

---

## Epic I: Security, Privacy, Moderation

### US-I1: Secure Image Storage
**As a** system  
**I want** to securely store and manage child images  
**So that** privacy risks are minimized.

**Acceptance Criteria**
- Encryption at rest
- Access control by user/project
- Configurable retention
- Audit logs

---

### US-I2: Moderation (OpenAI)
**As a** product owner  
**I want** content moderation on chat and generated text  
**So that** unsafe content is blocked.

**Acceptance Criteria**
- Moderate user chat input before sending to OpenAI
- Moderate generated text before saving
- Friendly refusal with retry guidance

---

## System State Machine (Reference)

`DRAFT_SETUP → CHARACTER_PREVIEW → CHAT → COMPILED → ILLUSTRATING → READY → EXPORTED`

---
